close all
clear
clc

%% Data

% Length of the links
l1 = 70;
l2 = l1/1.4;
l3 = l2/1.4;

L=[l1; l2; l3]';

n_joints = 4;
Q = [];
% End Effector Position (Initial & Final)
S1 = [10; 20; 20; 0];
S2 = [10; 20; 5; -pi/4];
S3 = [25; 50; 5; 0];
S4 = [25; 48; 10; -pi/6];
S5 = [25; 50; 15; -pi/3];
seq = [S1, S2, S3, S4, S5];

PROinv(S1, L, 1);
for i=1:length(seq(1,:))
    Q(:,i) = PROinv(seq(:,i), L, 1);
end

motor.A = 3;
motor.D = 3;
motor.V = 4;

% Adapt based on desired Workspace Positions, not arbitrarily
% Each q represents a joint, each entry represents a position

% q1 = deg2rad([0, 45, 135, 90]);
% q2 = deg2rad([0, 45, 90, 180]);
% q3 = deg2rad([0, 30, 120, 90]);
% q4 = deg2rad([0, 15, 90, 60]);
% 
% Q = [q1; q2; q3; q4];

[joint_positions, joint_velocities, joint_accelerations, time_vect] = PROlines_parabolas(Q, n_joints, motor);


run = 1;
while run == 1
    i = input("Which joint do you want to plot?\n");
    if (i <= 0) || (i > n_joints)
        disp("Invalid joint index")
        continue
    end

    figure;
    grid on;
    colors1 = lines(n_joints);
    
    % position
    % subplot(3, n_joints, i);
    plot(time_vect(i,:), joint_positions(i,:),'Color', colors1(i,:), ...
        'DisplayName', sprintf('$q_{%d}$', i), LineWidth=1.5);
    title(sprintf('Joint %d Position', i));
    xlabel('t [s]', Interpreter='latex')
    ylabel('q [rad]', Interpreter='latex')
    
    figure;
    grid on;
    % velocity
    % subplot(3, n_joints, i+4);
    plot(time_vect(i,:), joint_velocities(i,:),'Color', colors1(i,:), ...
        'DisplayName', sprintf('$q_{%d}$', i), LineWidth=1.5);
    title(sprintf('Joint %d Velocity', i));
    xlabel('t [s]', Interpreter='latex')
    ylabel('$\dot q$ [rad/s]', Interpreter='latex')
    
    figure;
    grid on;
    % acceleration
    % subplot(3, n_joints, i+8);
    plot(time_vect(i,:), joint_accelerations(i,:),'Color', colors1(i,:), ...
        'DisplayName', sprintf('$q_{%d}$', i), LineWidth=1.5);
    title(sprintf('Joint %d Acceleration', i));
    xlabel('t [s]', Interpreter='latex')
    ylabel('$\ddot q$ [rad/$s^2$]', Interpreter='latex')
    
    cont = input("Plot other Joints?\n [1] Yes\n [0] No\n");
    if cont == 1
        close all
    else
        break
    end

end

show_all = input("Show all plots?\n [1] Yes\n [0] No\n");
if show_all == 1
    close all
    for j = 1:n_joints
        figure(1);
        hold on
        grid on;
        subplot(n_joints, 1, j)
        plot(time_vect(j,:), joint_positions(j,:),'Color', colors1(j,:), ...
            'DisplayName', sprintf('$q_{%d}$', j), LineWidth=1.5);
        title(sprintf('Joint %d Position', j));
        xlabel('t [s]', Interpreter='latex')
        ylabel('$q [rad]$', Interpreter='latex')
        legend show
        set(legend, 'Interpreter', 'latex', 'FontSize', 12)

        figure(2);
        hold on
        grid on;
        subplot(n_joints, 1, j)
        plot(time_vect(j,:), joint_velocities(j,:),'Color', colors1(j,:), ...
            'DisplayName', sprintf('$q_{%d}$', j), LineWidth=1.5);
        title(sprintf('Joint %d Velocity', j));
        xlabel('t [s]', Interpreter='latex')
        ylabel('$\dot q [rad/s]$', Interpreter='latex')
        legend show
        set(legend, 'Interpreter', 'latex', 'FontSize', 12)

        figure(3);
        hold on
        grid on;
        subplot(n_joints, 1, j)
        plot(time_vect(j,:), joint_accelerations(j,:),'Color', colors1(j,:), ...
            'DisplayName', sprintf('$q_{%d}$', j), LineWidth=1.5);
        title(sprintf('Joint %d Acceleration', j));
        xlabel('t [s]', Interpreter='latex')
        ylabel('$\ddot q [rad/s^2]$', Interpreter='latex')
        legend show
        set(legend, 'Interpreter', 'latex', 'FontSize', 12)
    end
end






